---
layout: _post
title: 表连接方式介绍
date: 2019-08-09 13:59:20
categories: PostgreSQL
tags:
- join
- semi-join
- anti-join
---

表的连接方式有join，outer-join，semi-join，anti-join。

表连接实现方式如nested loop，merge，hash。

有两个数据源，t1(id primary key, name varchar(64))， t2(id primary key, name varchar(64))

# join

select t1.name,t2.name from t1,t2 where t1.id=t2.id;

或

select t1.name,t2.name from t1,t2 where t1 inner join t2 on t1.id=t2.id;

```shell
# nested looop join
for x in (select * from t1)
loop
	for y in (select * from t2)
	loop
		if (x.id == y.id)
			output_record(x.name,y.name)
		endif
	endloop
endloop
```

# outer-join

select t1.name,t2.name from t1,t2 where t1 left outer join t1 on t1.id=t2.id;

```shell
# nested looop outer-join
for x in (select * from t1)
loop
	find=false
	for y in (select * from t2)
	loop
		if (x.id == y.id)
			output_record(x.name,y.name)
			find=true
		endif
	endloop
	if (find == false)
		output_record(x.name, null)
	endif
endloop
```



# semi-join

select t1.name from t1 where exists(select 1 from t2 where t1.id=t2.id);

多在exists中使用，对外部表的每个键值，查找到内部匹配的第一个键值就返回，即找到一个就不在查找内部表其他的键值了。

```shell
# nested looop semi-join
for x in (select * from t1)
loop
	for y in (select * from t2)
	loop
		if (x.id == y.id)
			output_record(x.name,y.name)
			break
		endif
	endloop
endloop
```



# anti-join

select t1.name,t2.name from t1.t2 where t1.id!=t2.id;

多用于!=和not in等查询，找到满足条件的不返回，不满足条件的返回，和join相反。

```shell
# nested looop anti-join
for x in (select * from t1)
loop
	for y in (select * from t2)
	loop
		if (x.id != y.id)
			output_record(x.name,y.name)
		endif
	endloop
endloop
```
